configfile: "config.yaml"
SAMPLES=config["samples"]

rule all:
	input:
		expand("rarefied/{sample}.csv", sample=SAMPLES)


rule filter_apis:
	input:
		"{sample}.txt"
	output:
		"filtered/{sample}_filtered.txt"
	shell:
		"cat {input} | grep -v \"Apis mellifera\|unclassified\" > {output}"

rule translate:
	input:
		database = "beerolama_v1",
		readfile = "filtered/{sample}_filtered.txt"
	output:
		"translated/{sample}.labels"
	shell:
		"kraken-translate --db {input.database} {input.readfile} > {output}"

rule krakefaction:
	input:
		trans="translated/{sample}.labels",
		untrans="{sample}.txt"
	output:
		"rarefied/{sample}.csv"
	shell:
		"krakefaction -u {input.untrans} -t {input.trans} -o {output}"
